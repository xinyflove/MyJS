<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1, maximum-scale=1, user-scalable=no">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>915翻牌</title>
	<script src="js/ydui.flexible.js"></script>
	<script src="js/jquery.min.js"></script>
	<link rel="stylesheet" href="css/animate.css">
	<script src="js/easing.min.js"></script>
	<link rel="stylesheet" href="css/public.css">
	<link rel="stylesheet" type="text/css" href="css/ydui.css"/>
	<link rel="stylesheet" href="css/index.css">
	
</head>
<body>
	<div class="m-915-index">
		<ul class="index-yj">
			<dl class="index-scroll">
				<dd value="">
					<ol class="dl">  
	                    <li data-num="0" data-type = "1"><img src="images/1.png"></li>  
	                    <li data-num="1" data-type = "5"><img src="images/5.png"></li>  
	                    <li data-num="2" data-type = "9"><img src="images/9.png"></li>  
	                    <li data-num="3" data-type = "单"><img src="images/单.png"></li>  
	                    <li data-num="4" data-type = "免"><img src="images/免.png"></li>  
	               	</ol>
				</dd>
				<dd value="">
					<ol class="dl">  
	                    <li data-num"1" data-type = "1"><img src="images/1.png"></li>  
	                    <li data-num"2" data-type = "5"><img src="images/5.png"></li>  
	                    <li data-num"3" data-type = "9"><img src="images/9.png"></li>  
	                    <li data-num"4" data-type = "单"><img src="images/单.png"></li>  
	                    <li data-num"5" data-type = "免"><img src="images/免.png"></li>  
	               	</ol>
				</dd>
				<dd value="">
					<ol class="dl">  
	                    <li data-num"1" data-type = "1"><img src="images/1.png"></li>  
	                    <li data-num"2" data-type = "5"><img src="images/5.png"></li>  
	                    <li data-num"3" data-type = "9"><img src="images/9.png"></li>  
	                    <li data-num"4" data-type = "单"><img src="images/单.png"></li>  
	                    <li data-num"5" data-type = "免"><img src="images/免.png"></li>   
	               	</ol>
				</dd>
			</dl>
			<div class="index-icon">
				<img src="images/icon1.png" alt="">
				<img src="images/icon2.png" alt="">
				<img src="images/icon3.png" alt="">
				<img src="images/icon4.png" alt="">
				<img src="images/icon5.png" alt="">
			</div>
			<ul class="index-tab">
				<li class="tab-rules">活动规则</li>
				<li class="tab-count">抽奖次数 <span>1</span></li>
				<li class="tab-card">我的卡券</li>
			</ul>
			<div class="index-play"></div>
		</div>
		<div class="m-915-modal m-915-modal-1">
			<div class="modal-box-1">
				<div class="modal-1-top">
					<p>1、每人摇奖次数上限为3次</p>
					<p>2、抽中的卡牌自动派发到卡券包，在“我的卡券”中查看；</p>
					<p>3、每人摇奖次数上限为3次；</p>
					<p>4、抽中的卡牌自动派发到卡券包，在“我的卡券”中查看；</p>
					<p>5、活动最终解释权归915所有。</p>
					<p>6、活动最终解释权归915所有。</p>
					<p>7、活动最终解释权归915所有。</p>
					<p>8、活动最终解释权归915所有。</p>
				</div>
				<div class="modal-1-bottom">
					活动规则
				</div>
			</div>
			<div class="close">
				<img src="images/close.png">
			</div>
		</div>
		<div class="m-915-modal m-915-modal-2">
			<div class="modal-box">
				<div class="modal-2-header">
					
				</div>
				<div class="modal-2-top">
					<div class="modal-2-top-box">
						<ul>
							<li>
								<div>
									<img src="images/1.png">
								</div>
								<p>0张</p>
							</li>
							<li>
								<div>
									<img src="images/5.png">
								</div>
								<p>0张</p>
							</li>
							<li>
								<div>
									<img src="images/1.png">
								</div>
								<p>0张</p>
							</li>
							<li>
								<div>
									<img src="images/9.png">
								</div>
								<p>0张</p>
							</li>
							<li>
								<div>
									<img src="images/单.png">
								</div>
								<p>0张</p>
							</li>
							<li>
								<div>
									<img src="images/免.png">
								</div>
								<p>0张</p>
							</li>
						</ul>
					</div>
					<div class="modal-2-top-button">
						<button>合成</button>
					</div>
				</div>
				<div class="modal-2-bottom">
					我的卡券
				</div>
			</div>
			<div class="close">
				<img src="images/close.png">
			</div>
		</div>
		<div class="m-915-modal m-915-modal-3">
			<div class="modal-box-3 animated zoomIn">
				<img src="images/hecheng.png">
			</div>
		</div>
	</div>

</body>
<script type="text/javascript" src="js/ydui.js"></script>
<script>

$(function() {
	var dialog = window.YDUI.dialog;
	//点击按钮关闭
	$(".close").click(function(){
		$(".m-915-modal").hide();
	})
	// 点击合成
	$(".modal-2-top-button button").click(function(){
		$(".m-915-modal-3").show();
	}) 
	$('.index-tab li').click(function() {
		if($(this).attr('class') == 'tab-rules'){
			$(".m-915-modal-1").show();
		}else if($(this).attr('class') == 'tab-count'){
			
		}else if($(this).attr('class') == 'tab-card'){
			$(".m-915-modal-2").show();
		}
	})


	var oli=document.getElementsByTagName("dd"),  
     btn=document.querySelector(".index-play"),  
     odl=document.querySelectorAll(".dl"),  
     Let=12,H=20,first=3,second=5,
     third=8,cf=cs=ct=0,timer=null,str="";  
     // 抽奖次数
     //var count = 2;
    // $('.tab-count span').html(count)
    for (var i = 0; i < odl.length; i++) {  
        var html=odl[i].innerHTML;  
            odl[i].innerHTML="";  
            ck=stradd(html,1);  
            odl[i].innerHTML=ck;  
     };   
    function stradd(str,size){  
        if(Object.prototype.toString.call(str)  
            =="[object String]"){  
            for (var i = 0; i < size; i++) {  
                str+=str;  
            };   
        }else{  
            return "数据类型错误";  
        }  
         return str;  
    }  
    function getStyle(obj,name){  
       return obj.currentStyle?obj.currentStyle[name]:getComputedStyle(obj,false)[name];  
    }  
    function starmove(obj,json,funEnd){  
        clearInterval(obj.timer);  
        var Bstop=true;  
        obj.timer=setInterval(function(){  
            for(var attr in json){  
               var speed=0;  
               if(attr=="opacity"){  
                       var cur=Math.round(parseFloat(getStyle(obj,attr)*100));  
                   }else{  
                       var cur=parseInt(getStyle(obj,attr));  
                   }  
                   speed=(json[attr]-cur)/20;  
                   speed=speed>0?Math.ceil(speed):Math.floor(speed);   
                   if(cur!=json[attr]){  
                        Bstop=false;  
                   }else{  
                        Bstop=true;  
                   }  
  
                   if(attr=="opacity"){  
                   obj.style.opacity=(cur+speed)/100;  
               }else{  
                   obj.style[attr]=cur+speed+"px";  
               }  
            }  
            
            if(Bstop){  
                  clearInterval(obj.timer);  
                  if(funEnd)funEnd();  
            }  
        },30)  
     }  
     function run(arr){  
     	//var arr = [0,3,4]; //最终抽奖结果
        for (var i = 0; i < oli.length; i++) { 
            oli[i].value=arr[i]+5;  
        var Num=parseInt(oli[i].value),  
            odl=oli[i].getElementsByTagName("ol")[0],  
            odd=odl.getElementsByTagName("li"),  
            size=odd.length,  
            height=odl.offsetHeight,  
            tops=odd[Num+(size-Let)].offsetTop;  
            odl.style.top=0;  
            str+=Num;   
            starmove(odl,{"top":-(tops)},function(){  
                var Result=parseInt(str);  
                    console.log(Result);  
					$('.index-play').removeClass('active');
					setTimeout(function(){
						$('.m-915-modal-2').show();
					},500)
						
                        
                });    
               
  
           };  
		   
         }  
         // 点击抽奖
         btn.onclick=function(){  
			str=""
			// var arr = [0,1,2];
			// run(arr);
			//return false;
         		//$('.tab-count span').html(count)
				var _this = $(this); 
				if(!_this.hasClass('active')){
					_this.addClass('active');
				}


				$.ajax({
					url:"http://wx.tvplaza.cn/app/index.php?i=17&c=entry&rid=60&do=collect&m=collect_words",
					type:'post',
					dataType:'json',
					success:function(award){
						if(award.status==1){
							var arr = [award.words[0].key,award.words[1].key,award.words[2].key];
							$('#myword').empty();

							$("#myword").append(award.html);
							$("#c_number").html(award.prize_count);
							run(arr);
						}else{
							YDUI.dialog.toast(award.msg, 'none', function(){
								window.location.reload();
							});
							//$.toast(award.msg, "text");
						}
					}
				});
            	
     }
})
</script>
</html>